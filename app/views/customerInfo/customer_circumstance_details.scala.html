@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import models.circumstanceInfo.{CircumstanceDetails,BankDetails,PPOBAddress}
@import models.returnFrequency.ReturnPeriod
@import helpers.render_return_frequency
@import helpers.render_address
@import templates.breadcrumb

@(circumstances: CircumstanceDetails)(implicit user: User[_], messages: Messages, appConfig: config.AppConfig)

@bc = {
    @if(!user.isAgent){
        @breadcrumb()
    }
}

@registrationStatus() ={
    <div>
        <dt id="registration-status-text" class="cya-question">
            @messages("customer_details.registrationStatus.heading")
        </dt>
        <dd id="registration-status" class="cya-answer">
            Registered
        </dd>
        <dd class="cya-change">
            <a id="registration-status-link"
               href=@{appConfig.deregisterForVat}
               aria-label="@messages("customer_details.registration.deregister.hidden")">
            @messages("customer_details.deregister")
            </a>
        </dd>
    </div>
}

@customerName(orgName: String) = {
    <div>
        <dt id="business-name-text" class="cya-question">
            @messages("customer_details.businessName.heading")
        </dt>
        <dd id="business-name" class="cya-answer">
            @orgName
        </dd>
        <dd class="cya-change">
            <a id="business-name-status"
               onclick="sendGAEvent('business-name','change','change-business-details', @user.isAgent)"
               href="@{controllers.routes.ChangeBusinessNameController.show().url}"
               aria-label="@messages("customer_details.businessName.change.hidden",orgName)">
              @messages("customer_details.change")
            </a>
        </dd>
    </div>
}

@customerAddress(address: PPOBAddress, pending: Boolean) = {
    <div>
        <dt id="businessAddressHeading" class="cya-question">
            @messages("customer_details.businessAddress.heading")
        </dt>
        <dd id="businessAddress" class="cya-answer">
            @render_address(address)
        </dd>
        <dd class="cya-change">
            @if(pending){
                <span id="place-of-business-status"
                      class="bold"
                      aria-label="@messages("customer_details.businessAddress.pending.hidden")">
                    @messages("customer_details.pending")
                </span>
            } else {
                <a id="place-of-business-status"
                   onclick="sendGAEvent('business-address','change','change-business-details', @user.isAgent)"
                   href="@controllers.routes.BusinessAddressController.initialiseJourney()"
                   aria-label="@messages("customer_details.businessAddress.change.hidden",address.line1)">
                  @messages("customer_details.change")
                </a>
            }
        </dd>
    </div>
}

@customerBankDetails(bankDetails: BankDetails, pending: Boolean) = {
    <div>
        <dt id="bank-details-text" class="cya-question">
            @messages("customer_details.bankAccount.heading")
        </dt>
        <dd id="bank-details" class="cya-answer">
            <ol>
                @bankDetails.bankAccountNumber.map { accNum =>
                <li class="bold">@messages("customer_details.bankAccount.number")</li>
                <li>@accNum</li>
                }
                @bankDetails.sortCode.map { sortcode =>
                <li class="bold">@messages("customer_details.bankAccount.sortcode")</li>
                <li>@sortcode</li>
                }
            </ol>
        </dd>
        <dd class="cya-change">
            @if(pending){
                <span id="bank-details-status"
                      class="bold"
                      aria-label="@messages("customer_details.bankAccount.pending.hidden")">
                    @messages("customer_details.pending")
                </span>
            } else {
                <a id="bank-details-status"
                   onclick="sendGAEvent('bank-account','change','change-business-details', @user.isAgent)"
                   href="@controllers.routes.PaymentsController.sendToPayments()"
                   aria-label="@messages("customer_details.bankAccount.change.hidden")">
                @messages("customer_details.change")
                </a>
            }
        </dd>
    </div>
}

@customerReturnPeriod(period: ReturnPeriod, pending: Boolean) = {
    <div>
        <dt id="vat-return-dates-text" class="cya-question">
            @messages("customer_details.returnFrequency.heading")
        </dt>
        <dd id="vat-return-dates" class="cya-answer">
            @render_return_frequency(period)
        </dd>
        <dd class="cya-change">
            @if(pending){
                <span id="vat-return-dates-status"
                      class="bold"
                      aria-label="@messages("customer_details.returnFrequency.pending.hidden")">
                    @messages("customer_details.pending")
                </span>
            } else {
                <a id="vat-return-dates-status"
                   onclick="sendGAEvent('return-frequency','change','change-business-details', @user.isAgent)"
                   href="@controllers.returnFrequency.routes.ChooseDatesController.show()"
                   aria-label="@messages("customer_details.returnFrequency.change.hidden",render_return_frequency(period))">
                @messages("customer_details.change")
                </a>
            }
        </dd>
    </div>

}

@views.html.main_template(
    title = messages("customer_details.title"),
    bodyClasses = None,
    contentHeader = Some(bc),
    appConfig = appConfig) {

    <header class="page-heading">
        <h1 id="page-heading" data-metrics="vat-overview:view:change-business-details;@user.isAgent" class="heading-xlarge">@messages("customer_details.h1")</h1>
        <h2 id="sub-heading" class="heading-secondary">
            @if(user.isAgent) {@messages("customer_details.agentSubheading")
            } else {@messages("customer_details.subheading")}
        </h2>
    </header>


    @if(appConfig.features.registrationStatus()){
        <div class="form-group">
            <h2 class="heading-medium">@messages("customer_details.registration.heading")</h2>
            <dl class="govuk-check-your-answers cya-questions-short">
                @registrationStatus()
            </dl>
        </div>
    }


    <div class="form-group">
        <h2 class="heading-medium">@messages("customer_details.about.heading")</h2>
        <dl class="govuk-check-your-answers cya-questions-short">
            @circumstances.customerDetails.organisationName.map{ orgName =>
                @customerName(orgName)
            }

            @circumstances.pendingPPOBAddress.fold {
                @customerAddress(circumstances.ppobAddress,false)
            }{ pendingAddress =>
                @customerAddress(pendingAddress,true)
            }

            @circumstances.pendingBankDetails.fold {
                @circumstances.bankDetails.map{ bankDetails =>
                    @customerBankDetails(bankDetails,false)
                }
            }{ pendingBankDetails =>
                @customerBankDetails(pendingBankDetails,true)
            }

            @circumstances.pendingReturnPeriod.fold {
                @circumstances.returnPeriod.map{ period =>
                    @customerReturnPeriod(period,false)
                }
            }{ pendingPeriod =>
                @customerReturnPeriod(pendingPeriod,true)
            }

        </dl>
    </div>

    @if(user.isAgent){
        <p id="change-client-text">
            @messages("common.agent.changeClient.youCan")
            <a id="change-client-link"
               onclick="sendGAEvent('select-client','change','change-business-details', true)"
               href="@controllers.agentClientRelationship.routes.ConfirmClientVrnController.changeClient()">@messages("common.agent.changeClient.link")</a>.
        </p>
    }

}
